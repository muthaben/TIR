## 파일 저장

### AWS S3(Simple Storage Service)

S3는 EC2뿐만 아니라 웹, 다른 AWS 서비스에서도 **바로 파일에 접근**할 수 있도록 만들어진 서비스다.  
보통 웹 서비스를 운영할 때 가장 많이 사용하는 서비스로서 애플리케이션에 필요한 이미지 같은 **정적 데이터**부터  
서버에서 생성된 **로그 파일**이나 EBS 스냅샷 등 다양한 목적의 파일들을 보관하는 데 적합하다.

S3는 파일 관리에 다양한 강점이 있다. 우선 **내구성, 가용성 및 확장성**이 훌륭하다.  
99.999999999%의 내구성을 제공하도록 설계돼 있으며 일반 디스크와 다르게 용량에 대해 걱정할 필요가 없다.  
파일의 수와 저장 용량에 대한 제한 없이(저장하는 총 용량은 제한이 없으나 한 파일의 최대 용량은 5TB) S3에 업로드하기만 하면  
S3에서 알아서 파일들을 관리해준다.

파일 보안에 대해서도 여러 암호화 방식을 제공하고 파일에 대한 접근 권한도 유연하게 제어할 수 있다.  
그리고 여러 보안 표준 및 규정 준수 인증을 지원함으로써 대부분의 규제 기관의 규정 준수가 요구 사항을 충족하고 있다.

웹 콘솔을 제공하기 때문에 꼭 EC2를 통해서만 접근할 필요가 없다는 장점도 있다.  
또한 AWS의 다른 서비스와 연동할 수 있기 때문에 S3에 큰 데이터 파일을 업로드하고 관리하면서  
동시에 AWS의 다른 서비스들을 이용해 해당 파일들을 쿼리하고 분석하는 것도 가능하다.

버킷과 객체라는 개념이 존재하는데, **한 리전 내에 버킷을 생성하고 그 버킷 내부에 여러 객체를 업로드**해서 관리할 수 있다.  
디렉터리라는 별도의 개념이 존재하지는 않지만 객체의 이름에 '/' 특수문자를 포함해서 디렉터리를 조회하는 것처럼 이용할 수도 있다.

## 파일 제공

### AWS S3

클라이언트에게 제공돼야 하는 파일 중 코드와 같이 서버에 함께 배포되지 않은 파일들은 모두 S3와 같은 곳에 저장하고 관리하는 것이 좋다.  
사용자의 이미지 등 파일들을 S3에 올린 뒤 업로드된 객체의 경로만 데이터베이스에 저장해두면 다음부터는 클라이언트에서 직접 파일을 요청해서 내려받을 수 있다.

S3는 **정적 웹 사이트 호스팅**기능도 지원한다.  
예전에는 HTML, 이미지, JS, CSS 파일로만 이뤄진 웹 사이트라도 서버에 웹 서버를 설치해서 호스팅했어야 했지만  
S3를 이용하면 해당 파일들을 S3에 올리고 웹 사이트 호스팅 기능을 설정하는 것만으로도 바로 정적 웹 사이트 호스팅이 가능하다.

### AWS CloudFront

AWS CDN(Content Delivery Network)서비스다. CDN 이란 여러 지역에 있는 사용자드에게 더 빠르게 콘텐츠를 전달할 수 있는 방식이다.  
S3를 오리진 서버로 둬서 이미지, JS와 같은 정적 파일부터 동영상 스트리밍과 같은 콘텐츠도 전달할 수 있다.
S3에 있는 원본 데이터가 수정되거나 삭제되는 경우 복사본을 가진 모든 CDN 서버의 데이터를 업데이트하거나 삭제할 수도 있다.

클라이언트가 콘텐츠를 요청할 때 원본 데이터를 가진 오리진 서버가 응답을 주는 대신 클라이언트와 더욱 가까운 곳에 존재하는 CDN 서버가 대신 응답을 주어  
훨씬 빠른 속도로 콘텐츠를 전달할 수 있게 된다.
또한 오리진 서버에 갈 요청을 CDN 서버들이 분산해서 처리하기 때문에 오리진 서버에 대한 트래픽이나 부하도 줄일 수 있다.  
CDN이 효율적으로 작동하기 위해서는 어느 위치에서도 클라이언트에게 빠르게 응답을 줄 수 있도록 CDN 서버가 여러 지역에 존재해야 한다.

👉 CloudFront 작동 방식
데이터를 가진 S3 서버가 서울에 있고 미국 시애틀에 있는 클라이언트에서 해당 데이터를 요청하는 경우

1. 클라이언트가 CloudFront에게 특정 데이터를 달라고 요청한다.
2. CloudFront는 시애틀에 있는 클라이언트에게 가장 빠르게 응답을 줄 수 있는 시애틀의 엣지 로케이션 서버에게 요청을 전달한다.
3. 해당 서버가 데이터를 가지고 있다면 바로 응답을 주고, 데이터를 가지고 있지 않다면 오리진 서버인 서울의 S3 서버에게 데이터를 가져와 임시로 보관해둔 뒤 클라이언트에게 응답한다.
4. 다음부터 시애틀에서 같은 콘텐츠를 요청하는 클라이언트가 있는 경우 저장된 데이터를 이용해 빠르게 응답해 준다.
