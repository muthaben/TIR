## AWS IAM(Identity and Access Management)

AWS에서는 사용자별로 AWS에서 제공하는 서비스들, 서비스에 생성된 자원 등에 대해 세분된 권한을 지정할 수 있게 해준다.  
그리고 사용자뿐만 아니라 서비스에서 생성된 자원에 대해서도 계정과 권한을 만들어서 관리할 수 있게 해준다.

### 👉 IAM 용어

#### 1. 권한

AWS의 서비스나 자원에 대해 **어떤 작업을 할 수 있는지 명시해두는 규칙**이다.  
예를 들어, "서울 리전에 있는 EC2를 조회할 수 있다"와 같은 항목이 하나의 권한이 된다.

#### 2. 정책

**권한들의 모음**이다.  
사용자나 그룹들에 **권한을 직접 적용할 수는 없고** 권한들로 만들어진 정책을 적용해야 한다.  
정책은 사용자, 그룹, 역할에 적용할 수 있다.

#### 3. 사용자

**AWS의 기능과 자원을 이용하는 객체**다.  
사용자별로 **어떤 권한을 가졌는지 세분화**해서 지정할 수 있다.  
사용자는 AWS Console에 로그인할 수 있는 사람일 수도 있고, 자동화되어 실행되는 프로그램일 수도 있다.  
**접속하는 사용자인 경우에는 비밀번호**가 제공되지만, **프로그램인 경우에는 액세스 키 ID와 비밀 액세스 키**가 제공된다.

#### 4. 그룹

여러 사용자에게 **공통으로 권한을 부여**할 수 있게 만들어진 개념이다.  
하나의 그룹에 여러 명의 사용자를 지정할 수 있다.

#### 5. 역할

**어떤 행위를 하는 객체에 여러 정책을 적용**한다는 점에서 사용자와 비슷하지만 **객체가 사용자가 아닌 서비스나 다른 AWS 계정의 사용자**라는 점에서 차이가 있다.  
보통은 사용자가 아닌 **특정 서비스에서 생성한 객체에 권한을 부여**하는 데 사용된다.  
예를 들어, 우리가 만들어서 사용하는 EC2 인스턴스가 S3에서 파일을 읽어오려면 S3 파일을 읽을 수 있는 권한으로 정책을 만든 뒤에 해당 정책으로 역할을 만들어 EC2 인스턴스에 지정해야 한다.  
EC2 인스턴스 내에서 AWS 서비스를 사용하는 다양한 애플리케이션들에 권한을 주기 위해 사용자 키를 인스턴스에 저장해두는 방법도 있지만 이는 관리하기가 불편하다.  
따라서 EC2 인스턴스에 역할을 부여하고 이 인스턴스 내의 모든 애플리케이션이 실행할 수 있는 권한을 지정해두는 방법을 사용한다.  
서비스에 지정되는 역할은 서비스 역할이라고 부른다.

#### 6. 인스턴스 프로파일

사용자가 사람을 구분하고 그 사람에 권한을 주기 위한 개념이었다면 인스턴스 프로파일은 **EC2 인스턴스를 구분하고 그 인스턴스에 권한을 주기**위한 개념이다.  
인스턴스 프로파일은 역할을 위한 **컨테이너**로서 **인스턴스 시작 시 EC2 인스턴스에 역할 정보를 전달**하는 데 사용된다.  
인스턴스 프로파일이 지정된 EC2는 시작 시 역할 정보를 받아오고 해당 역할로 필요한 권한들을 얻게 된다.  
인스턴스 프로파일은 AWS 콘솔에서 역할을 생성할 때 EC2 역할로 생성할 경우 자동으로 함께 생성된다.

## AWS CodeDeploy

CodeDeploy는 AWS 배포 자동화 서비스로서 EC2 인스턴스들에 코드를 배포하는 과정을 자동으로 진행해준다.
자동화 서비스란 사람이 해야 할 일을 명령어로 적어두고 프로그램이 그 명령을 순차적으로 실행하는 것이다.
AWS의 다른 서비스와 손쉽게 연동해서 사용할 수 있다는 장점이 있다.

### CodeDeploy 작동 절차

1. 우리가 개발한 애플리케이션 소스코드 프로젝트의 최상단 경로에 AppSpec.yml 파일을 추가한다.  
   이 파일은 배포에 필요한 모든 절차들을 적어둔 명세서와 같다.  
   프로젝트를 코드 저장소인 깃허브나 파일 저장소인 AWS S3에 업로드한다.
2. CodeDeploy에 프로젝트의 특정 버전을 배포해 달라고 요청한다.
3. CodeDeploy는 배포를 진행할 EC2 인스턴스들에 설치돼 있는 CodeDeploy Agent들과 통신하며 Agent들에게 요청받은 버전을 배포해 달라고 요청한다.
4. 요청을 받은 CodeDeploy Agent들은 코드 저장소에서 프로젝트 전체를 서버에 내려받는다.  
   그리고 내려받은 프로젝트에 있는 AppSpec.yml 파일을 읽고 해당 파일에 적힌 절차대로 배포를 진행한다.
5. CodeDeploy Agent는 배포의 성공/실패 여부를 CodeDeploy에게 알려준다.

### CodeDeploy 구성 요소

#### CodeDeploy Agent

자동으로 배포가 진행될 **EC2 인스턴스**에 설치되어 **CodeDeploy의 명령을 기다리고 있는 프로그램**이다.  
CodeDeploy가 EC2 인스턴스를 직접 조작하는 것이 아니라 CodeDeploy Agent가 모든 배포 행위를 진행하는 것이기 때문에  
CodeDeploy로 배포를 진행하고자 한다면 반드시 EC2 인스턴스에 설치돼 있어야 한다.  
이 프로그램은 CodeDeploy와 통신을 계속 하다가 배포를 진행하라는 명령을 받으면 AppSpec.yml 파일에 있는 절차 그대로 따라서 배포를 진행한다.  
그리고 배포가 완료되거나 실패하면 CodeDeploy에 결과를 알린다.

#### AppSpec.yml

CodeDeploy Agent가 배포 명령을 받았을 때 **어떻게 배포를 진행해야 하는지 적어둔 (YAML 양식으로 정의된)명세서 파일** 파일이다.  
저장소에서 내려받은 프로젝트 파일들을 서버 내 어떤 디렉터리로 옮길지, 어떤 권한의 계정으로 명령어를 실행할 지 등 배포에 필요한 다양한 설정들을 제공한다.  
또한 설치 전, 설치 후, 배포 성공 검증 등 다양한 이벤트들에 대한 후크를 제공한다.
